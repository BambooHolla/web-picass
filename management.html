<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1">
    <link href="dist/static/favicon.ico" rel="shortcut icon" type="image/x-icon">
    <title>币加所</title>
    <!-- <link rel="stylesheet" type="text/css" href="./dist/css/hover.css"> -->
    <link rel="stylesheet" type="text/css" href="./dist/css/common.css">
    <!-- 引用首页的样式 -->
    <link rel="stylesheet" type="text/css" href="./dist/css/main.css">
    <link rel="stylesheet" type="text/css" href="./dist/css/app.css">
    <link rel="stylesheet" type="text/css" href="./dist/css/animate.css">

    <!-- 本页样式调整 -->
    <link rel="stylesheet" type="text/css" href="./dist/css/management.css">
    <!-- 英文状态下的样式调整 -->
    <link rel="stylesheet" type="text/css" href="./dist/css/englishStyle.css">

</head>

<body style=" min-height: 100%;" id="body">
    <div id="app">
        <!-- 导航 -->
        <nav class="nav right ">
            <div class="nav-logo">
                <img src="./dist/images/home/nav_logo.png" alt="">
            </div>
            <div class="mob-navicon topbar-btn">
                <img class="mob-navicon-logo" src="./dist/images/home/nav_logo.png" alt="">
                <img class="mob-navicon-text" src="./dist/images/home/mob_navicon.png" alt="">
            </div>
            <ul class="web-nav">
                <li class="tag  ">
                    <a data-href="index.html#home" data-i18n='nav.home'>首页</a>
                </li>
                <li class="tag ">
                    <a data-href="index.html#picassotxt" data-i18n='nav.picasso'>币加所</a>
                </li>
                <li class="tag">
                    <a data-href="index.html#download" data-i18n='nav.download'>下载中心</a>
                </li>
                <li class="tag nav-active">
                    <a data-href="management.html" data-i18n='nav.assets' class="asset">资产管理</a>
                </li>
                <li>
                    <dl class="select_lang" id="slide_lang" data-widget="#slide_lang"> <dt data-i18n='nav.language'>简体中文</dt>
                        <dd id="slide_lang_box" data-widget="#slide_lang" style="display: none;"> <a data-lang="zh_cn" class="" data-i18n='nav.languageSwich'>English</a> </dd>
                    </dl>
                </li>
                <li class="login nav-login">
                    <a data-href="login.html" style="font-size: 12px;" data-i18n='nav.login'>登录 / 注册</a>

                </li>
            </ul>
        </nav>
        <span class="target mobile-none"></span>
        <div class="main">
            <div class="assets-title">
                <img src="./dist/images/management/Assets.png" alt="">
                <p data-i18n='assets.title'>资产管理</p>

            </div>
            <div class="assets-content">
                <div class="rate">
                    <!-- 折合数据接口获取，先写死 -->
                    <span data-i18n='assets.total'>总资产折合</span>：<span id="total">总资产加载中...</span> <span id="priceId"></span>
                    <!-- 约等于 先去掉 -->
                    <!-- ≈ <span id="CNY">0</span> CNY -->
                </div>
                <div>
                    <ul id="content" cellspacing="0">
                        <li class="content-th">
                            <div data-i18n='assets.th-1'>币 种</div>
                            <div data-i18n='assets.th-2'>可 用</div>
                            <div data-i18n='assets.th-3'>冻 结</div>
                            <div data-i18n='assets.th-4'>操 作</div>
                        </li>
                        <!-- 接口获取数据，字符串拼接，不可用 `` ie10不兼容 -->
                        <!-- 模板 -->
                        <!-- <li class="content-td">
                            <div>
                                <div>USDT</div>
                            </div>
                            <div>
                                <div>0.00000000</div>
                            </div>
                            <div>
                                <div>0.00000000</div>
                            </div>
                            <div>
                                <div class="content-btn">
                                    <button class="warning">提币</button>
                                    <button class="warning">充币</button>
                                </div>
                            </div>
                        </li> -->
                        <div id="totalsData">
                            <li class="content-td">
                                <div style="width:100%">
                                    <div id="totalsData-text">资产列表加载中...</div>
                                </div>

                            </li>
                        </div>
                    </ul>
                </div>
            </div>
        </div>
        <div class="down-foot">
            <div class="company">
                <div class="contact-icon">
                    <a>
                        <img src="./dist/images/home/1.png" alt="">
                    </a>
                    <a>
                        <img src="./dist/images/home/weixin.png" alt="">
                    </a>
                    <a>
                        <img src="./dist/images/home/xinglang.png" alt="">
                    </a>
                    <a>
                        <img src="./dist/images/home/4.png" alt="">
                    </a>
                    <a>
                        <img src="./dist/images/home/5.png" alt="">
                    </a>
                    <a>
                        <img src="./dist/images/home/6.png" alt="">
                    </a>

                </div>
            </div>
            <ol>
                <li><a href="javascript:void(0)" data-i18n="foot.about" id="foot-about">关于我们</a></li>
                <li>|</li>
                <li><a href="javascript:void(0)" data-i18n="foot.contact" id="foot-contact">联系我们</a></li>
                <li>|</li>
                <li><a href="javascript:void(0)" data-i18n="foot.service" id="foot-business">商务合作</a></li>
            </ol>
            <div class="grant">
                <span data-i18n="foot.copyright">Copyright @2017 PICASSO BLOCKCHAIN TECHNOLOGY (MALTA) LIMITED</span>
            </div>
        </div>
    </div>

    <!-- mobile menu -->
    <div class=" navbar  animated-1 fff" id="navbar">
        <ul class="page-list" id="page-list">
            <li>
                <a data-href="index.html#home">
                    <p data-to="toIndex" data-i18n="nav.home">主页</p>
                </a>
            </li>
            <li>
                <a data-href="index.html#picassotxt">
                    <p data-i18n='nav.picasso'>币加所</p>
                </a>
            </li>
            <li>
                <a data-href="index.html#download">
                    <p data-i18n='nav.download'>下载中心</p>
                </a>
            </li>
            <li>
                <a data-href="management.html" class="asset">
                    <p data-i18n='nav.assets'>资产管理</p>
                </a>
            </li>
            <li class="moblie-nav">
                <!-- <a href="login.html" style="font-size: 14px;">登录</a>
                <a href="javascript:;">&nbsp;/&nbsp;</a>
                <a href="register.html" style="font-size: 14px;">注册</a> -->
                <a data-href="login.html" style="font-size: 12px;" data-i18n="nav.login">登录 / 注册</a>
            </li>
            <li>
                <p id="lan_exchange" data-i18n="nav.languageSwich">English</p>
            </li>
        </ul>
    </div>
    <!-- end -->
    <script type="text/javascript" src="./dist/js/hm.js"></script>
    <script type="text/javascript" src="./dist/js/jquery.min.js"></script>
    <script type="text/javascript" src="./dist/js/main.js"></script>
    <!-- 登录状态 -->
    <script type="text/javascript" src="./dist/js/login-state.js"></script>
    <script type="text/javascript" src="./dist/js/picasso-request.js"></script>
    <!-- layer插件 -->
    <script type="text/javascript" src="./dist/libs/layer/layer.js"></script>


    <!-- 关于我们   layer弹窗 -->
    <script type="text/javascript" src="./dist/js/footAbout.js"></script>

    <script type="text/javascript">
        // 未登入 跳到登入界面
        if (!sessionStorage.token || !sessionStorage.name) {
            var hash = window.location.hash ? window.location.hash : '';
            location.href = "login.html" + hash;
        }
        
        // //登入，获取数据
        $(function() {

            var getFrozenCount = 0;
            var productIdArray = []
                //冻结持仓，在最后才调用
            function getFrozen(accountId) {
                if (getFrozenCount >= productIdArray.length) {
                    return;
                }

                $.picassoGet('/account/accounts/products', {
                    accountId: accountId,
                    productId: productIdArray[getFrozenCount]
                }, function(data) {
                    var freezeBalance = (data.freezeBalance / 100000000).toFixed(10);
                    freezeBalance = numberFormat(freezeBalance,true);
                    $('#id_' + productIdArray[getFrozenCount]).text(parseFloat(freezeBalance))
                    getFrozenCount++;
                    getFrozen(accountId)
                }, function(err) {
                    console.log(err);
                    layer.msg(err.message, {
                        time: 2000
                    });

                });
            }

            // 获取总资产
            function getAllAssets(frequency){
                if(frequency > 0){
                    $.picassoGet('/account/accounts/assets', {
                        accountType: '003'
                    }, function(assetsData) {
                        var total = (assetsData.asset.total / 100000000).toFixed(10);
                        var priceId = assetsData.asset.priceId;
                        total = numberFormat(total,true)
                        
                        //获取总资产对应的单位
                        $.picassoGet('/product/product/' + priceId, {},
                            function(priceIdData) {
                                setTimeout(function() {
                                    $('#total').text(parseFloat(total));
                                    $('#priceId').text(priceIdData.productName);
                                }, 500);

                            },
                            function(priceIdErr) {
                                console.log(priceIdErr);
                                $('#total').text(parseFloat('获取数据失败,请刷新网页'));
                                $('#priceId').text("");
                            });

                    }, function(assetsErr) {
                        console.log(assetsErr);
                        getAllAssets(--frequency)
                    });
                } else {
                    $('#total').text('获取数据失败,请刷新网页');
                    $('#totalsData-text ').text('获取数据失败,请刷新网页');
                        layer.msg('获取数据失败,请刷新网页', {
                            time: 2000
                        });
                } 
            }
            getAllAssets(3);


            // 获取持仓
            totalLength = 0;
            totalCount = 0;
            totalStr = '';
            totalArr = [];
            totalnum = 0;
            function showTotalsList(){
                if(!totalStr){
                    $('#totalsData').html('<li class="content-td"><div style="width:100%;"><div>获取数据出错，请刷新网页</div></div></li>')
                    return ;
                }
                var accountId = totalArr[0].accountId;
                setTimeout(function() {
                    $('#totalsData').html(totalStr)
                    getFrozenCount = 0;
                    // 获取冻结
                    getFrozen(accountId)
                    var language = $('#slide_lang dt').text().trim()


                    // layer弹出框
                    $('.warning').click(function() {

                        //判断语言
                        var content = '';
                        var language = $('#slide_lang dt').text().trim()
                        if (language == "简体中文") {
                            content = '<div><div><img src="./dist/images/management/PromptIcon.png" alt=""></div><p>很抱歉的提醒您，为了保证用户资产的安全，目前币加所暂未上线PC端充币/提币等功能，请您赴下载中心下载币加所APP。</p><a href="index.html#download">下载中心</a></div>'
                        } else if (language == "English") {
                            content = "<div class='en-as-layer'><div><img src='./dist/images/management/PromptIcon.png' alt=''></div><p>Sorry, the top up and withdrawal functions on PC are not available temporarily for the sake of guaranteeing the security of user's assets.Please go to Download Center for Picasso App.</p><a href='index.html#download?en'>Download Center</a> </div>"

                        } else {
                            content = '<div><div><img src="./dist/images/management/PromptIcon.png" alt=""></div><p>很抱歉的提醒您，为了保证用户资产的安全，目前币加所暂未上线PC端充币/提币等功能，请您赴下载中心下载币加所APP。</p><a href="index.html#download">下载中心</a></div>'
                        }
                        layer.open({
                            type: 1,
                            title: false,
                            area: ['690px', '430px'],
                            skin: 'layui-layer-demo', //样式类名
                            closeBtn: 0, //不显示关闭按钮
                            anim: 0, //动画效果
                            shadeClose: true, //开启遮罩关闭
                            content: content
                        });
                    });
                }, 500);
            }

            function numberFormatDelete0(number){
                var arrExp;
                if(typeof number == "number") number = number.toString();
                number = number.split("").reverse().join("");
                arrExp = /[1-9|\.]/ig.exec(number)
                if(arrExp){
                    if(arrExp[0] == '.'){
                    number = number.substring(arrExp.index+1)
                    } else {
                    number = number.substring(arrExp.index)
                    }
                    return  number.split("").reverse().join("")
                }
                return number;
            }
             //格式处理
             function numberFormat(number,delete0){
                var saveNumber = number;
                number = typeof number == "string" ? number : number.toString();
                if(delete0){
                    number = numberFormatDelete0(number);
                }
                    number = number.split('.');
                
                if(!number[0]){
                    return saveNumber;
                }
                if(number[0].length > 1){
                    number[0] =  number[0].replace(/\b(0+)/gi,"");
                    number[0] = number[0] == ''? "0": number[0];
                }
                if(number[1]) {
                    number[1] =  number[1].length > 4? number[1].substr(0,4) : number[1];
                    return number[0]+'.'+number[1];
                } else {
                    return number[0];
                }
            }

            

            //保证币种顺序
            function getAlltotals(){
                
                if(!totalArr[totalnum]){
                    showTotalsList();
                    return ;
                }
                
                var productId = totalArr[totalnum].productId
                var totalAmount = (totalArr[totalnum].totalAmount / 100000000).toFixed(10);
                totalAmount = numberFormat(totalAmount,true);
                ++totalnum;

                $.picassoGet('/product/product/' + productId, {},
                    function(productIdData) {
                        var str = '<li class="content-td"><div><div>';
                        str += productIdData.productName + "</div></div><div><div>";
                        str += totalAmount + "</div></div><div><div id='id_" + productId + "'>0</div></div>";

                        var language = $('#slide_lang dt').text().trim()
                        productIdArray.push(productId)
                        if (language == "简体中文") {
                            str += '<div><div class="content-btn"><button class="warning" data-i18n="assets.btn-1">提币</button><button class="warning" data-i18n="assets.btn-2">充币</button></div></div></li>';
                        } else if (language == "English") {
                            str += '<div><div class="content-btn"><button class="warning en-as-btn" data-i18n="assets.btn-1">deposit</button><button class="warning en-as-btn" data-i18n="assets.btn-2">withdraw</button></div></div></li>';

                        } else {
                            str += '<div><div class="content-btn"><button class="warning" data-i18n="assets.btn-1">提币</button><button class="warning" data-i18n="assets.btn-2">充币</button></div></div></li>';
                        }
                        totalStr += str;
                        getAlltotals();
                        
                    },
                    function(productIdErr) {
                        getAlltotals();
                    })
            }

            $.picassoGet('/account/position/totals', {},
                function(totalsData) {
                    totalStr = ""
                    totalArr = totalsData;
                    totalLength = totalsData.length;
                    totalnum = 0;
                    productIdArray = []

                    if (totalLength > 0) {
                        getAlltotals();
                    } else {

                        var str = '<li class="content-td"><div style="width:100%;"><div>当前账户还没有资产，请先进行资产<a class="warning" style="border-bottom:1px solid #c1b17f;cursor:pointer;"> 充值 </a>。</div></div></li>';
                        totalStr += str;
                        setTimeout(function() {

                            $('#totalsData').html(totalStr)
                                // layer弹出框
                            $('.warning').click(function() {
                                layer.open({
                                    type: 1,
                                    title: false,
                                    area: ['690px', '430px'],
                                    skin: 'layui-layer-demo', //样式类名
                                    closeBtn: 0, //不显示关闭按钮
                                    anim: 0, //动画效果
                                    shadeClose: true, //开启遮罩关闭
                                    content: '<div><div><img src="./dist/images/management/PromptIcon.png" alt=""></div><p>&nbsp;&nbsp;&nbsp;&nbsp;很抱歉的提醒您，为了保证用户资产的安全， 目前币加所暂未上线PC端充币/提币等功能， 请您赴下载中心下载币加所APP。<div style="width:100%;height:8px;"></div></p><a href="index.html#download">下载中心</a></div>'
                                });
                            });
                        }, 500);
                    }

                },
                function(totalsErr) {
                    console.log(totalsErr);
                    $('#totalsData').html('<li class="content-td"><div style="width:100%;"><div>获取数据出错，请刷新网页</div></div></li>')
            });

        })
    </script>

    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?f39218da2a6e9068ee0b5d66a050cde6";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>
    <script>
        var winWidth = $(window).width();
        $(function() {
            setTimeout(function() {
                $('#body').css(
                    'opacity', '1'
                )
            }, 20);
            var navActive = document.querySelector(".nav-active");
            var navUnderline = document.querySelector('.nav ul');

            function navActiveFunc(num) {
                $('.tag').removeClass('nav-active');
                $('.tag').eq(num).addClass('nav-active');
                var target = document.querySelector(".target");
                var navActive = document.querySelector(".nav-active");
                var width = navActive.getBoundingClientRect().width;
                var height = navActive.getBoundingClientRect().height;
                var left = navActive.getBoundingClientRect().left + window.pageXOffset;
                var top = navActive.getBoundingClientRect().top + window.pageYOffset;

                target.style.width = width + "px";
                target.style.height = height + "px";
                target.style.left = left + "px";
                target.style.top = top + "px";
                target.style.borderColor = color;
                target.style.borderWidth = '3px'
                target.style.transform = "none";
                target.style.zIndex = 1;
            }
            navActiveFunc(3);

            function mouseleaveFunc() {
                navActive = document.querySelector(".nav-active");
                var width = navActive.getBoundingClientRect().width;
                var height = navActive.getBoundingClientRect().height;
                var left = navActive.getBoundingClientRect().left + window.pageXOffset;
                var top = navActive.getBoundingClientRect().top + window.pageYOffset;

                target.style.width = width + "px";
                target.style.height = height + "px";
                target.style.left = left + "px";
                target.style.top = top + "px";
                target.style.borderColor = color;
                target.style.borderWidth = '3px'
                target.style.transform = "none";
                target.style.zIndex = 1;
            }
            navUnderline.addEventListener("mouseleave", mouseleaveFunc);
        });

    </script>
    <!-- 国际化 -->
    <script type="text/javascript" src="./dist/js/i18next-1.6.3.js"></script>
    <script type="text/javascript" src="./dist/js/language.js"></script>
</body>

</html>